# Addness UI 操作ガイド（CDP経由 Playwright用）

最終更新: 2026-02-26

## 接続方法

```python
from playwright.sync_api import sync_playwright
pw = sync_playwright().start()
browser = pw.chromium.connect_over_cdp("http://localhost:9222")
page = browser.contexts[0].pages[0]  # or pages[1]

# 操作後は接続だけ切断（ブラウザは閉じない）
browser.close()
pw.stop()
# ⚠️ context.close() は絶対に呼ばないこと（ブラウザが閉じる）
```

## URL構造

| ページ | URL |
|-------|-----|
| ゴール一覧 | `https://www.addness.com/goals` |
| 特定のゴール | `https://www.addness.com/goals/{goal_id}` |
| アクション（サブゴール） | `https://www.addness.com/goals/{action_id}` |

日向のゴール: `https://www.addness.com/goals/2486eec7-95e3-4d5d-8a9f-d1c899c70f40`

## ゴールページのレイアウト

```
┌──────────────────────────────────────────────────────────────┐
│ パンくず: 『スキルプラス』をス... > 誰が作っても...          │
│                                                              │
│ [P あとN日] [📅 >]              [👤名前] [👤👤+N] [...]     │
│                                                              │
│               ゴールタイトル                                  │
│                                                              │
│ [完了基準パネル（📅 > で展開/折りたたみ）]                     │
│   【完了基準】1. ... 2. ... 3. ... 4. ...                    │
│   【スコープ】...                                            │
│                                                              │
│ ○ 完了済み(N件) ○ アーカイブ(N件) [共有] [📅] [AIと相談]     │
│                                                              │
│ [👤] ゴール名1  [P あとN日] [●N/M] [💬N] [✓] [✏️] [...]     │
│ [👤] ゴール名2  [P あとN日] [●N/M] [💬N] [✓] [✏️] [...]     │
│ ...                                                          │
│                                                              │
│ [@でメンション/CmdかCtrl＋Enterでコメントを送信]              │
│ [+]                                            [🎙️] [➤]     │
└──────────────────────────────────────────────────────────────┘
```

**`●N/M` = 完了基準（KPI）の進捗。N=達成数、M=目標数。**

### ヘッダー要素

| 要素 | 位置(目安) | 説明 |
|-----|----------|------|
| `P あとN日` | x=110, y=70 | 優先度 + 期日までの残り日数 |
| 📅 `>` | x=190, y=70 | 完了基準テキストの表示/非表示トグル |
| 👤 名前 | x=1100, y=70 | アサインされた人（複数可） |
| `+N` | x=1148, y=70 | 追加アサイン人数 |
| `...` | x=1204, y=70 | ゴールメニュー |

## ゴール「...」メニュー（13項目）

クリック: `page.mouse.click(1204, 125)`

| メニュー項目 | 操作内容 |
|------------|--------|
| **完了** | ゴールを完了状態にする |
| **Objective付け替え** | 親ゴール（Objective）を変更 |
| **期日を設定** | YYYY/MM/DD形式で期日入力 → 保存 |
| **成果物をアップロード** | ファイルアップロード |
| **KPIを設定する** | KPI追加ダイアログ（タイトル・単位・目標数値） |
| **繰り返し** | サブメニューあり |
| **関連するゴールを追加** | 関連ゴールのリンク |
| **URLをコピー** | ゴールURLをクリップボードにコピー |
| **ゴールの一括編集** | 複数アクションの一括編集モード |
| **AIエージェントをアサイン** | AIエージェント割り当て |
| **アーカイブ** | ゴールをアーカイブ |
| **削除したゴール復元** | 削除済みゴールの復元 |
| **削除** | ゴール削除（赤字） |

## アクション行の操作

各ゴール/アクション行の右側に以下の要素が並ぶ：

| 要素 | 説明 | 例 |
|-----|------|-----|
| `P あとN日` | 優先度 + 残り日数 | `P あと124日` |
| `● N/M` | **完了基準（KPI進捗）** — 達成数/目標数、緑丸アイコン | `● 7/28`, `● 184/213` |
| `💬 N` | コメント数 | `💬 4` |
| ✓ | 完了マークをつける | |
| ✏️ | インライン編集 | |
| ... | メニュー | |

**座標はウィンドウ幅や解像度で変わる。セレクターかaria-labelで特定するのが安全。**

日向のゴール（1280px幅時の目安座標）:

| アイコン | X座標(目安) | 説明 |
|---------|-----------|------|
| `P --` | x=950付近 | 優先度 |
| `● --/--` | x=1010付近 | KPI進捗 |
| 💬 N | x=1080付近 | コメント数 |
| ✓ | x=1135 | 完了マーク |
| ✏️ | x=1173 | インライン編集 |
| ... | x=1209 | メニュー |

**Y座標は行番号で変わる**（1行目=289, 2行目=355, 3行目=421, 4行目=487, 5行目=553, 間隔≈66px）

### アクション「...」メニュー（9項目）

クリック例: `page.mouse.click(1213, 289)` （1行目の場合）

| メニュー項目 | 操作内容 |
|------------|--------|
| **完了** | アクションを完了状態にする |
| **アサイン** | 担当者を割り当て |
| **Objective付け替え** | 親ゴールを変更 |
| **期日を設定** | YYYY/MM/DD形式で期日入力 → 保存 |
| **繰り返し** | サブメニューあり |
| **URLをコピー** | アクションURLをクリップボード |
| **ゴールの一括編集** | 一括編集モード |
| **アーカイブ** | アーカイブ |
| **削除** | 削除（赤字） |

## アクションの新規追加

ページ下部（スクロール必要）に入力フィールドがある。

```python
# スクロールしてフィールドを表示
input_field = page.locator('input[placeholder*="タイトルを"]')
input_field.scroll_into_view_if_needed()
input_field.fill("新しいアクション名")
input_field.press("Enter")
```

セレクター: `input[placeholder="タイトルを「〜する」の形で入力"]`

## アクション詳細ページ

アクション名をクリックすると詳細ページに遷移（URLは `/goals/{action_id}`）。

構成:
- パンくず（スキルプラス > 親ゴール > アクション名）
- アクションタイトル
- サブアクション追加フィールド: `input[placeholder*="タイトルを"]`
- コメント欄
- Activity history

## 期日設定ダイアログ

ゴール・アクションどちらでも同じUI。

```python
# メニューから「期日を設定」をクリック後に表示される
page.locator('text=期日を設定').click()
# 日付入力
page.locator('input[placeholder*="YYYY/MM/DD"]').fill("2026/03/15")
# 保存
page.locator('text=保存').click()
```

ボタン: クリア / キャンセル / 保存（青）

## KPI設定ダイアログ

ゴール「...」メニュー → 「KPIを設定する」で表示。

フィールド:
- タイトル（テキスト入力）
- 単位（テキスト入力）
- 目標数値（数値入力）

ボタン: 完了（青）

## AIと相談

```python
page.locator('text=AIと相談').click()
# 右側にチャットパネルが開く
```

- 右側パネルに過去のAI会話スレッドが表示
- 下部に入力欄: `AIに相談...`
- モデル選択: Addy2.0 nano
- ゴール参照（紐づけ済み）が表示される

## コメント投稿

ゴール/アクション詳細ページ下部のコメント欄:

```python
comment_box = page.locator('textarea[placeholder*="@でメンション"]')
comment_box.fill("@甲原海人 コメント内容")
# Cmd+Enter で送信
comment_box.press("Meta+Enter")
```

または送信ボタン（➤）をクリック。

## 完了マーク

アクション行の✓アイコンをクリック:

```python
# 1行目のアクションを完了にする
page.mouse.click(1135, 289)
```

## 左サイドバー

| アイコン | 機能 |
|---------|------|
| ✏️ ロゴ | ホーム |
| ◎ ゴール | ゴール一覧 |
| 🔔 通知 | 通知一覧 |
| ✉️ 実行 | 実行一覧 |
| 👥 メンバー | メンバー管理 |
| ❓ ヘルプ | ヘルプ |
| 向 | 日向のアバター |

## 操作のコツ

1. **テキストセレクターより座標クリックが確実** — Addnessは同じテキストが複数箇所にあることが多い
2. **メニュー項目は `text=` セレクターで安全** — メニューが表示された後は一意になる
3. **ダイアログは Escape で閉じる** — `page.keyboard.press("Escape")`
4. **ページ遷移後は `time.sleep(3)` を入れる** — SPAなのでレンダリング待ちが必要
5. **スクリーンショットで確認** — `page.screenshot(path="/tmp/debug.png")` で状態確認
