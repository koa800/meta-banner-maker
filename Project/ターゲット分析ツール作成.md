# ターゲット分析ツール作成

最終更新: 2026-02-22

## 概要

Instagram公開データからターゲットユーザーのインサイトを分析し、広告クリエイティブ制作に活用するCLIツール。

## ステータス

- [x] Mode A: ユーザーフォロー分析
- [x] Mode B: 投稿いいね → ターゲット発掘
- [x] キャッシュ機能（TTL 7日）
- [x] Apify連携（クッキー不要）
- [x] Claude分析（カテゴリ分類・ペルソナマッチング・レポート生成）

## 使い方

### Mode A: ユーザー分析

ターゲットに近い人のアカウントを指定 → フォロー先を分析 → インサイトレポート生成

```bash
python System/sns_analyzer.py @ユーザー名
python System/sns_analyzer.py @ユーザー名 --max 200
```

### Mode B: 投稿いいねからターゲット発掘

自社/競合の投稿にいいねした人を分析 → ペルソナマッチ → 上位N人のフォロー分析 → 統合レポート

```bash
python System/sns_analyzer.py --post https://instagram.com/p/XXXXX --persona "20代女性、美容に興味"
python System/sns_analyzer.py --post https://instagram.com/p/XXXXX --persona "30代男性" --top 5
```

### オプション

| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `--max N` | フォロー取得数上限 | 300 |
| `--max-likers N` | いいねユーザー取得上限 | 1000 |
| `--top N` | Mode Bで深掘りする上位人数 | 5 |
| `--no-cache` | キャッシュを無視して再取得 | - |
| `--json` | JSON形式で出力 | - |
| `-v` | 詳細ログ出力 | - |

## ファイル構成

| ファイル | 内容 |
|---------|------|
| `System/sns_analyzer.py` | メインCLIツール |
| `System/sns_analyzer_config.json` | 設定ファイル（gitignore対象） |
| `System/sns_analyzer_cache/` | キャッシュディレクトリ（gitignore対象） |

## 分析フロー

### Mode A
```
@username
  → Apify: フォローリスト取得（datadoping/instagram-following-scraper）
  → Apify: プロフィール詳細取得（apify/instagram-profile-scraper）
  → Claude: カテゴリ分類（50件バッチ）
  → Claude: インサイトレポート生成
```

### Mode B
```
投稿URL + ペルソナ条件
  → Apify: いいねユーザー取得（scraping_solutions/instagram-engagers-...）
  → Claude: ペルソナマッチング（スコア0-100）
  → 上位N人に対してMode Aを実行
  → Claude: 統合インサイトレポート生成
```

## レポート内容

### Mode A
1. フォロー概要（総数、カテゴリ分布）
2. 興味関心マップ（上位カテゴリ + サブカテゴリ）
3. コンテンツ消費傾向
4. 注目フォロー先（ブランド・インフルエンサー）
5. 広告クリエイティブへの示唆（トーン、メッセージング、フォーマット）
6. ペルソナサマリー

### Mode B
1. いいねユーザー概要（取得数、ペルソナマッチ数）
2. マッチしたユーザー一覧（スコア順）
3. 共通フォロー先ランキング
4. 統合カテゴリ分布
5. ターゲット層の共通インサイト
6. 広告クリエイティブへの示唆

## 技術構成

| コンポーネント | 実装 |
|--------------|------|
| DataProvider ABC | `ApifyProvider`（後でInstaloader等追加可） |
| フォロー取得 | `datadoping/instagram-following-scraper`（クッキー不要） |
| プロフィール取得 | `apify/instagram-profile-scraper` |
| いいね取得 | `scraping_solutions/instagram-engagers-likers-and-commenters-no-cookies` |
| 分析エンジン | Claude API (claude-sonnet-4) |
| キャッシュ | ローカルJSONファイル、TTL 7日 |

## コスト

| プラン | 内容 |
|-------|------|
| Apify無料枠 | 月$5 |
| Mode A 1回 | ~$1-3（フォロー数次第） |
| Mode B 1回 | ~$10-20（分析人数次第） |
| Claude API | 1回あたり数セント |

## 設定

`System/sns_analyzer_config.json` に以下を設定:

```json
{
  "apify_api_token": "（Apifyトークン）",
  "anthropic_api_key": "（空欄なら環境変数ANTHROPIC_API_KEYを使用）"
}
```

## 今後の拡張候補

- [ ] 特定カテゴリの深掘り分析（「Business領域だけ詳しく」等）
- [ ] 複数ユーザーの比較分析
- [ ] レポートのMarkdownファイル出力
- [ ] LINE秘書からの実行対応
