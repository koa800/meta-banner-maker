# ゴール実行エンジン設計

## 基本情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | ゴール実行エンジン（AI秘書 v2） |
| 開始日 | 2026年2月25日 |
| 最終更新 | 2026年2月25日（Phase 2 実装完了） |
| ステータス | 🚧 Phase 1-2 実装完了・Phase 3 未着手 |
| 前提 | `Project/AI秘書作成.md`（現行システム）の上位互換 |

---

## ビジョン

甲原さんが注力すること:

1. **クリエイティブ** — 人間にしかできない創造
2. **意思決定の設計** — 仕組みが正しく動くように作る側
3. **オフラインの人間関係** — 対面でしか生まれない信頼

**それ以外は全てシステムが回す。**

「やりたいこと」を1行伝えるだけで、適切なAIまたは人間に振り分けられ、実行され、結果だけが返ってくる。

---

## 耐久性の設計原則

このシステムは、以下が変わっても**コード修正ゼロ**で対応できる構造を取る。

| 変わるもの | 例 | 対応方法 |
|-----------|------|---------|
| AIツール | Lubert → 別の画像AI | profiles.json のエントリ差し替え |
| AIモデル | Sonnet 4.6 → 次世代モデル | profiles.json の model_id 変更 |
| チームメンバー | 日向退職、新人加入 | profiles.json の追加・無効化 |
| コミュニケーション手段 | LINE → Slack、新しいツール | profiles.json の interface 変更 |
| 事業内容 | 広告事業 → 別事業 | ツール定義ファイルの追加・削除 |
| コスト構造 | API値上げ、新料金体系 | profiles.json の cost 更新 |
| ワークフロー | AI運用 → 人間に移譲 | profiles.json の transfer_status 変更 |

### 3つの不変レイヤー

```
【変わらないもの】

① 思考構造: ゴール → 分解 → 委任 → 統合 → 報告
   → 人間の仕事の進め方そのもの。時代に依存しない

② 統一インターフェース: 全てのエージェント（人間/AI）は同じ形式で登録・呼び出し
   → 「誰が」「何を」できるかだけ知っていれば、「どう呼ぶか」は設定の問題

③ 確認の階層: 読み取り→生成→送信→不可逆→人間判断
   → リスクに応じた確認。ツールが変わっても判断基準は同じ
```

```
【設定で吸収するもの】

profiles.json     = 誰が何をできるか（人間もAIも）
tool_registry.json = どんな能力があるか（ツール定義）
config.json        = 接続情報・APIキー・閾値
```

```
【コードが担うもの（最小限）】

coordinator.py     = ゴール→分解→委任→統合のループ（数十行）
handler_runner.py  = ツール定義に従ってハンドラを実行する汎用ランナー
```

**コードは「仕組み」だけ。「何をするか」「誰に頼むか」は全て設定ファイル。**

---

## アーキテクチャ

```
甲原さん（ゴールだけ伝える）
    │
    ▼
┌──────────────────────────────────────────────┐
│  入口（LINE / Chatwork / 将来: 何でも）        │
└──────────────┬───────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────┐
│  Render (app.py) — 受信・中継                  │
│  既存コマンド一致 → 従来フロー                  │
│  一致しない → Coordinator へ転送               │
└──────────────┬───────────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────────┐
│  Coordinator（司令塔）                         │
│                                                │
│  入力: ゴール（自然言語）                       │
│  参照: profiles.json + tool_registry.json      │
│  処理:                                         │
│    ① 意図を理解する                            │
│    ② 必要な能力を特定する                       │
│    ③ profiles.json から最適なエージェントを選ぶ  │
│    ④ tool_registry.json の定義に従って呼び出す   │
│    ⑤ 結果を統合して報告                         │
│    ⑥ 次のアクションを提案 or 確認を取る          │
│                                                │
│  自身は何も実行しない。振り分けと統合だけ。       │
└──────┬──────────┬──────────┬─────────────────┘
       │          │          │
       ▼          ▼          ▼
  ┌─────────────────────────────────────┐
  │  エージェント群（profiles.json で管理） │
  │                                       │
  │  人間: 日向、三上、他メンバー           │
  │  AI:   Claude, Perplexity, Lubert 等  │
  │  WF:   広告レポート生成、等            │
  │                                       │
  │  ※全て同じインターフェースで呼ばれる    │
  │  ※追加・削除はJSONの編集だけ           │
  └─────────────────────────────────────┘
```

---

## 統一エージェントスキーマ（profiles.json）

人間もAIもワークフローも、全て同じ構造で登録する。

### 共通フィールド

```json
{
  "name": "エージェント名",

  "type": "human | ai | workflow",

  "status": "active | inactive | transferring",

  "interface": {
    "method": "line_message | chatwork_message | email | api_call | mcp | workflow_endpoint",
    "config": {}
  },

  "capabilities": ["返信案生成", "画像生成", "広告運用", "データ分析"],

  "best_for": ["具体的なユースケース"],
  "not_good_at": ["苦手なこと"],

  "constraints": {
    "speed": "即時 | 秒単位 | 分単位 | 時間単位 | 日単位",
    "cost": "無料 | 低 | 中 | 高",
    "availability": "24/7 | 営業時間 | 不定期"
  },

  "context_access": ["IDENTITY.md", "KPIデータ", "メール履歴"],

  "transfer": {
    "transferable_to": null,
    "transfer_status": null,
    "transfer_started": null,
    "transfer_target": null
  },

  "notes": "自由記述"
}
```

### フィールド設計の意図

| フィールド | なぜ必要か | 変化への耐性 |
|-----------|-----------|-------------|
| `type` | Coordinatorが人間/AIで振る舞いを変える（人間には確認、AIには即実行） | 新しいtypeが増えても既存ロジックに影響しない |
| `status` | 退職・サービス停止・移譲中を表現 | コードを触らず無効化できる |
| `interface.method` | 呼び出し方の抽象化。LINEかAPIかMCPか | 新しい通信手段が増えたらmethodを追加するだけ |
| `interface.config` | 接続に必要な具体情報（API key env, endpoint, LINE ID等） | ツール固有の設定を吸収 |
| `capabilities` | 何ができるか（自然言語タグ） | Coordinatorがゴールと照合して選ぶ |
| `constraints` | 速度・コスト・稼働時間 | Coordinatorが最適な相手を選ぶ判断材料 |
| `context_access` | アクセスできる社内データ | セキュリティ境界。外部AIに社内データを渡さない |
| `transfer` | ワークフロー移譲の状態管理 | AIで構築→人間に渡す流れを設定で管理 |

### 具体例

#### 人間

```json
{
  "name": "日向",
  "type": "human",
  "status": "active",
  "category": "直下メンバー",
  "interface": {
    "method": "line_message",
    "config": { "display_name": "日向" }
  },
  "capabilities": ["Meta広告運用", "クリエイティブ制作", "数値分析", "入稿作業"],
  "best_for": ["広告運用判断", "入稿作業", "クリエイティブ最終判断"],
  "not_good_at": ["コーディング", "LP設計"],
  "constraints": {
    "speed": "時間単位",
    "cost": "高（人件費）",
    "availability": "営業時間"
  },
  "context_access": ["KPIデータ", "広告アカウント", "クリエイティブ素材"],
  "transfer": {},
  "notes": "広告運用の実務責任者"
}
```

#### AI（テキスト生成）

```json
{
  "name": "Claude Sonnet",
  "type": "ai",
  "status": "active",
  "category": "AI・常駐",
  "interface": {
    "method": "api_call",
    "config": {
      "provider": "anthropic",
      "model_id": "claude-sonnet-4-6",
      "api_key_env": "ANTHROPIC_API_KEY",
      "max_tokens_default": 600
    }
  },
  "capabilities": ["日本語文章生成", "データ分析", "口調再現", "コード生成", "要約", "翻訳"],
  "best_for": ["返信案生成", "KPI分析", "LP構成案", "メール下書き", "議事録要約"],
  "not_good_at": ["最新情報の検索", "画像生成", "動画生成"],
  "constraints": {
    "speed": "秒単位",
    "cost": "低",
    "availability": "24/7"
  },
  "context_access": ["IDENTITY.md", "profiles.json", "KPIデータ", "メール履歴", "スプレッドシート"],
  "transfer": {},
  "notes": "甲原さんの口調再現に最適化済み"
}
```

#### AI（画像生成）

```json
{
  "name": "Lubert",
  "type": "ai",
  "status": "active",
  "category": "AI・クリエイティブ",
  "interface": {
    "method": "api_call",
    "config": {
      "provider": "lubert",
      "api_key_env": "LUBERT_API_KEY",
      "endpoint": "https://api.lubert.ai/v1/generate"
    }
  },
  "capabilities": ["画像生成", "バナー制作", "広告ビジュアル"],
  "best_for": ["広告バナー", "LP素材", "SNS投稿画像"],
  "not_good_at": ["テキスト生成", "データ分析", "動画"],
  "constraints": {
    "speed": "秒単位",
    "cost": "中",
    "availability": "24/7"
  },
  "context_access": [],
  "transfer": {},
  "notes": "現在のメイン画像生成ツール。トレンドに応じて差し替え可能"
}
```

#### ワークフロー（AI→人間移譲型）

```json
{
  "name": "広告レポート生成",
  "type": "workflow",
  "status": "active",
  "category": "AI・ワークフロー",
  "interface": {
    "method": "workflow_endpoint",
    "config": {
      "endpoint": "http://mac-mini-agent:8500/workflow/ad_report"
    }
  },
  "capabilities": ["広告データ集計", "レポート生成", "異常値検出"],
  "best_for": ["週次広告レポート", "媒体別パフォーマンス比較"],
  "not_good_at": ["リアルタイム判断", "クリエイティブ評価"],
  "constraints": {
    "speed": "分単位",
    "cost": "中",
    "availability": "24/7"
  },
  "context_access": ["KPIデータ", "広告アカウント"],
  "transfer": {
    "transferable_to": "日向",
    "transfer_status": "Phase 1（AI全自動）",
    "transfer_started": null,
    "transfer_target": null
  },
  "notes": "安定後に日向へ移譲予定"
}
```

---

## ツールレジストリ（tool_registry.json）

Coordinatorが呼び出せるツール（能力）の定義。profiles.jsonの「誰ができるか」と対になる。

```json
{
  "tools": [
    {
      "name": "calendar",
      "description": "予定の確認・追加・変更",
      "confirmation_level": "L1",
      "handler": "calendar_manager.py",
      "input_schema": {
        "action": "list | add | update",
        "days": "number (default: 7)",
        "title": "string (addの場合)",
        "start": "datetime (addの場合)"
      }
    },
    {
      "name": "mail",
      "description": "メールの確認・返信案生成・送信",
      "confirmation_level": "L1（確認） / L3（送信）",
      "handler": "mail_manager.py",
      "input_schema": {
        "action": "check | draft | send",
        "account": "personal | kohara"
      }
    },
    {
      "name": "kpi",
      "description": "事業数値の取得・分析",
      "confirmation_level": "L1",
      "handler": "kpi_query",
      "input_schema": {
        "query": "string (自然言語の質問)"
      }
    },
    {
      "name": "people",
      "description": "人物プロファイル検索・担当推薦",
      "confirmation_level": "L1",
      "handler": "who_to_ask.py",
      "input_schema": {
        "query": "string (誰に頼む？何を知りたい？)"
      }
    },
    {
      "name": "search",
      "description": "Web検索・企業調査・市場動向",
      "confirmation_level": "L1",
      "preferred_agent": "Perplexity",
      "input_schema": {
        "query": "string"
      }
    },
    {
      "name": "sheets",
      "description": "スプレッドシートの読み書き",
      "confirmation_level": "L1（読み取り） / L3（書き込み）",
      "handler": "sheets_manager.py",
      "input_schema": {
        "action": "read | write",
        "sheet_id": "string",
        "range": "string"
      }
    },
    {
      "name": "addness",
      "description": "Addnessゴール・タスクの確認・更新",
      "confirmation_level": "L1",
      "handler": "addness_to_context.py",
      "input_schema": {
        "action": "list | sync"
      }
    },
    {
      "name": "draft_reply",
      "description": "甲原さんの口調で返信案を生成",
      "confirmation_level": "L2",
      "preferred_agent": "Claude Sonnet",
      "requires_context": ["IDENTITY.md", "sender_profile"],
      "input_schema": {
        "recipient": "string",
        "context": "string",
        "channel": "line | chatwork | email"
      }
    },
    {
      "name": "generate_image",
      "description": "画像・バナー・ビジュアル素材の生成",
      "confirmation_level": "L2",
      "preferred_agent": "Lubert",
      "input_schema": {
        "prompt": "string",
        "style": "string (optional)",
        "size": "string (optional)"
      }
    },
    {
      "name": "generate_video",
      "description": "動画素材・広告動画の生成",
      "confirmation_level": "L2",
      "preferred_agent": null,
      "input_schema": {
        "prompt": "string",
        "duration": "number (seconds)",
        "style": "string (optional)"
      }
    },
    {
      "name": "send_message",
      "description": "LINE/Chatwork/メールでメッセージを送信",
      "confirmation_level": "L3",
      "input_schema": {
        "recipient": "string",
        "channel": "line | chatwork | email",
        "content": "string"
      }
    },
    {
      "name": "ask_human",
      "description": "人間に質問・確認・依頼を送る",
      "confirmation_level": "L3",
      "input_schema": {
        "recipient": "string",
        "question": "string",
        "urgency": "high | normal | low"
      }
    },
    {
      "name": "analyze",
      "description": "状況分析・優先度判定・提案",
      "confirmation_level": "L2",
      "preferred_agent": "Claude Sonnet",
      "input_schema": {
        "query": "string",
        "data_sources": ["kpi", "mail", "calendar", "addness"]
      }
    }
  ]
}
```

### ツール追加の手順

新しい能力を追加するとき:

```
1. tool_registry.json にツール定義を1件追加
2. profiles.json に対応するエージェントが既にいれば → 完了
3. 新しいエージェントが必要なら → profiles.json にも追加
4. Coordinator のコード変更 → 不要
```

---

## Coordinator 設計

### 役割

Coordinatorは**自分では何も実行しない**。やることは4つだけ:

1. ゴールの意図を理解する
2. **認識をすり合わせる**（自分が合っていると思い込まない）
3. 最適なエージェントを選ぶ
4. 結果を統合して返す

### 認識確認の原則（最重要）

**「自分が合っている」と思い込まないこと。**

Coordinatorは曖昧なゴールを受け取ったら、実行前に必ず認識を提示して確認する。

**「認識が合っている」の定義:**

| 要素 | 意味 | 確認すること |
|------|------|------------|
| **視野** | 何を見ているか | 対象範囲に抜け漏れがないか |
| **視座** | どの立場から見ているか | 誰の目線で考えるか |
| **視点** | 何に注目しているか | 優先すべきポイントは何か |

3つが揃って初めて「認識が合っている」と言える。

```
✕「このタスクを実行していいですか？」
  → 許可を求めている。判断を甲原さんに丸投げしている

○「この認識で合っていますか？」
  → 視野・視座・視点のすり合わせ。ズレがあれば修正できる
```

具体例:

```
ゴール「来週の商談に備えて」

✕ 悪い聞き方:
  「カレンダーを確認して商談準備メモを作成してよいですか？」

○ 良い聞き方:
  「来週の商談 = カレンダーにある予定のことですね。
   【視野】参加者情報・過去のやり取り・関連数値
   【視座】甲原さんが商談で主導権を持てる状態にする
   【視点】先方への未返信（見積もり）が最優先
   この認識で合っていますか？」
```

確認が取れたら即座に実行に移る。

確認不要で即実行してよいケース:
- 「今日何すればいい？」のような明確な情報取得
- 「KPI教えて」のような単純な照会
- 「メール確認して」のような既存コマンド相当

### 処理フロー

```
入力: ゴール（自然言語） + 送信者情報

Step 0: 認識確認（曖昧なゴールの場合）
  - ゴールの解釈を提示
  - 「この認識で合っていますか？」
  - 確認が取れたら Step 1 へ

Step 1: 意図理解（LLM 1回）
  - ゴールを分解
  - 必要なツールを tool_registry.json から選択
  - 実行順序を決定（並列可能なものは並列）

Step 2: 実行ループ
  while ツール呼び出しがある:
    - ツール定義に従って実行
    - preferred_agent があればそのエージェントに委任
    - なければ capabilities が一致するエージェントを profiles.json から検索
    - 結果を受け取る
    - LLM に結果を渡して次のステップを判断

Step 3: 統合・報告
  - 全結果をまとめる
  - 確認が必要なアクションがあれば提案
  - 最終回答を返す
```

### Coordinator が参照するもの

| 判断 | 参照先 |
|------|--------|
| 何がしたいか | メッセージ本文 |
| 何が必要か | tool_registry.json |
| 誰に頼むか | profiles.json（status: active のもの） |
| すぐやるか確認するか | tool_registry.json の confirmation_level |
| どの口調で返すか | IDENTITY.md（甲原さんへの報告時） |

### Coordinator のモデル選択

```
意図理解・振り分け: haiku（軽い。計画だけ）
結果統合・報告文: haiku（結果をまとめるだけ）
返信案生成: sonnet（口調再現が必要な場合のみ）
```

---

## 確認・エスカレーション戦略

### レベル定義

| Level | 内容 | 動作 | 例 |
|-------|------|------|-----|
| **L1** | 情報取得 | 黙って実行 | カレンダー確認、KPI取得、人物検索 |
| **L2** | 分析・生成 | 実行して結果を報告 | 準備メモ、返信案、レポート、画像生成 |
| **L3** | 外部送信 | 案を見せて承認を取る | LINE送信、メール返信、Chatwork投稿 |
| **L4** | 不可逆操作 | 理由付きで確認 | 削除、設定変更、金銭関連 |
| **L5** | 人間判断 | 甲原さんに戻す | クリエイティブ判断、意思決定、対面 |

### L5 の判断基準（甲原さんに戻すとき）

- 正解が1つに定まらない創造的判断
- 事業の方向性に関わる意思決定
- 人間関係の機微が必要な対応
- Coordinator が「自信がない」と判断した場合
- 予算を超えるコストが発生する操作

### 承認UI（既存を活用）

```
秘書グループで:
  「1」  → 承認（そのまま実行）
  「2 内容」→ 修正して実行
  「却下」  → 実行しない
```

---

## ワークフロー移譲の設計

AIで構築したワークフローは、安定したら人間に渡す。

```
Phase 1: AIが全自動で実行（構築・検証期間）
Phase 2: AIが実行、人間が結果を確認（引き継ぎ期間）
Phase 3: 人間が実行、AIはサポート（移譲完了）
Phase 4: 人間が完全自走、AIは監視のみ
```

Coordinator は profiles.json の `transfer.transfer_status` を見て自動的に振り先を変える。コード変更不要。

---

## 変化への対応シナリオ

### シナリオ1: 画像生成AIを乗り換える

```
変更前: Lubert で画像生成
変更後: 新しいAI「ImageX」に切り替え

手順:
1. profiles.json の Lubert を status: "inactive" に
2. profiles.json に ImageX を追加（同じ capabilities）
3. 完了。Coordinator は次回から ImageX を選ぶ
```

### シナリオ2: チームメンバーが変わる

```
日向が退職、後任の佐藤が入社

手順:
1. profiles.json の日向を status: "inactive"
2. profiles.json に佐藤を追加（capabilities を記入）
3. transfer 中のワークフローがあれば transferable_to を佐藤に変更
4. 完了
```

### シナリオ3: 新しい通信チャネルが増える

```
Slack を導入

手順:
1. interface.method に "slack_message" を追加
2. 既存メンバーで Slack を使う人の interface を更新
3. handler_runner.py に slack_message の送信処理を追加（唯一のコード変更）
4. 完了
```

### シナリオ4: MCP対応ツールが登場する

```
外部の MCP サーバーを接続したい

手順:
1. profiles.json に type: "ai", interface.method: "mcp" で追加
2. interface.config に MCP の接続情報を記入
3. handler_runner.py に mcp の呼び出し処理を追加（1回だけ）
4. 以後、MCP ツールは profiles.json に追加するだけ
```

### シナリオ5: 事業が変わる

```
広告事業 → 別事業に軸足を移す

手順:
1. tool_registry.json から広告系ツールを削除 or 非表示
2. 新事業用のツールを tool_registry.json に追加
3. 対応するエージェントを profiles.json に追加
4. Coordinator のコード変更 → 不要
```

---

## コスト設計

### ランニングコスト

| カテゴリ | 月額 | 備考 |
|---------|------|------|
| **テキストAI（Claude + Perplexity + OpenAI）** | ¥5,000 → ¥15,000 | 利用量に応じて段階的に増加 |
| **画像 + 動画生成AI** | ¥30,000 〜 ¥50,000 | 固定予算枠。ツールは随時入れ替え |
| **インフラ** | ¥1,500 → ¥5,000 | ストレージ増加分 |
| **合計** | **¥36,500 〜 ¥70,000/月** | |

```
年間: 約 ¥44万 〜 ¥84万
```

### コスト管理の仕組み

- profiles.json の `constraints.cost` でエージェントごとのコスト感を管理
- Coordinator はコストの低いエージェントを優先的に選ぶ（同じ capabilities なら安い方）
- 画像/動画AI は月額予算枠で管理。枠を超えそうなら甲原さんに確認（L5）

### 生成AIツールの切り替え容易性

```
画像/動画生成AIはトレンドで入れ替わる。
profiles.json で管理しているため:

  今月: Lubert (¥20,000) + 動画AI A (¥15,000) = ¥35,000
  来月: 新画像AI (¥15,000) + 動画AI B (¥20,000) = ¥35,000

  → profiles.json の2エントリを差し替えるだけ
  → 予算枠 ¥30,000-50,000 の中で自由に組み合わせる
```

### 開発コスト（一回きり）

| Phase | 内容 | 工数 |
|-------|------|------|
| 1 | Coordinator + ツールレジストリ + ハンドラランナー | 13h |
| 2 | profiles.json 統一スキーマ化 + AI登録 | 5h |
| 3 | ワークフロー基盤 + 移譲管理 | 8h |
| 4 | 画像/動画AI連携（interface.method: api_call の汎用実装） | 8h |
| **合計** | | **34h** |

Phase 1 の 13h で「ゴールを伝えるだけで動く」最小構成が完成する。

---

## 段階的移行計画

### Phase 1: Coordinator 追加（既存を壊さない）

```
変更:
  ① tool_registry.json を作成（既存ハンドラの定義）
  ② coordinator.py を新規作成（ゴール→分解→委任→統合ループ）
  ③ handler_runner.py を新規作成（ツール定義に従って実行する汎用ランナー）
  ④ local_agent.py: パターン未一致 → coordinator に渡す分岐追加
  ⑤ app.py: function名 "execute_goal" をタスクとして転送

変更しない:
  - 既存コマンド（「1」「2」「リスト」等）→ 従来フロー
  - Orchestrator スケジュール
  - 認証・通信フロー
  - profiles.json（Phase 2 で対応）
```

### Phase 2: profiles.json 統一スキーマ化

```
変更:
  ① 既存の人間プロファイルに type, interface, capabilities 等を追加
  ② AI エージェントを登録（Claude, Perplexity, Lubert）
  ③ Coordinator が profiles.json を参照して振り先を決定
```

### Phase 3: ワークフロー基盤 + 生成AI連携

```
変更:
  ① handler_runner.py に api_call / workflow_endpoint / mcp の汎用呼び出しを実装
  ② 画像/動画生成AIの profiles を追加
  ③ ワークフロー移譲の transfer_status 管理を実装
```

---

## 実行例

### 「来週の商談に備えて」

```
Coordinator:
  意図 = 商談準備
  必要なツール = calendar + people + mail
  並列可能 → 3つ同時

  📅 calendar → 来週火曜14:00 ABC社 田中さん
  👤 people → 田中太郎、取締役、取引歴2年
  📧 mail → 先週見積もり送付、返信なし

Coordinator 統合:
  「来週火曜14:00 ABC社 田中さんとの商談。
   先週送った見積もりの返信が来てません。
   フォローメール送りますか？」

甲原: 「うん」

  💬 draft_reply（→ Claude Sonnet）→ 甲原の口調でメール生成

  「こう送ります: ...
   送信していい？」

甲原: 「1」→ send_message 実行
```

### 「TikTok広告のクリエイティブ作って」

```
Coordinator:
  意図 = 広告クリエイティブ制作
  必要なツール = kpi（現状把握） + analyze（方向性） + generate_image or generate_video

  📊 kpi → 現在のTikTok広告パフォーマンス
  🧠 analyze（→ Claude Sonnet）→ 「CTR低下。フック弱い。冒頭3秒のインパクト強化を推奨」

Coordinator:
  「TikTok広告の現状: CTR低下傾向。
   方向性: 冒頭3秒のインパクト強化。

   コンセプト案を3つ作りますか？」

甲原: 「うん」

  🎨 draft_reply（→ Claude Sonnet）→ コンセプト3案 + プロンプト案

  「3案できました:
   ① 問題提起型「まだ○○してるの？」
   ② 変化実感型「3ヶ月でこう変わった」
   ③ 権威型「プロが教える○○」

   画像生成に進みますか？どの案で？」

甲原: 「①で」→ L5判断（クリエイティブ方向性）

  🖼️ generate_image（→ Lubert）→ バナー画像生成
```

### 「今日何すればいい？」

```
Coordinator: 並列で全領域チェック

  📅 calendar → 今日の予定3件
  📧 mail → 返信待ち2件（1件急ぎ）
  📊 kpi → 異常値なし
  🎯 addness → 今週期限のゴール1件

Coordinator 統合:
  「今日やること:
   ① 10:00 チームMTG
   ② 急ぎ: ABC社見積もり依頼に返信
   ③ 14:00 1on1 日向
   ④ 今週中: 月次レビュー準備

   ②の返信案作りますか？」
```

---

## 付録: 既存ハンドラ → ツール対応表

| ツール名 | 既存実装 | handler_runner での呼び出し |
|---------|---------|--------------------------|
| calendar | `calendar_manager.py` | subprocess or import |
| mail | `mail_manager.py` | subprocess or import |
| kpi | `local_agent.py: kpi_query()` | 関数呼び出し |
| people | `who_to_ask.py` | subprocess |
| sheets | `sheets_manager.py` | subprocess or import |
| addness | `addness_to_context.py` | subprocess |
| draft_reply | `local_agent.py: generate_reply_suggestion()` | 関数呼び出し |
| analyze | `local_agent.py: context_query()` | 関数呼び出し |
| send_message | `app.py: send_reply_to_group()` | API POST to Render |
| generate_image | 新規（Lubert API） | profiles.json の interface に従う |
| generate_video | 新規（動画AI API） | profiles.json の interface に従う |
| search | 新規（Perplexity API） | profiles.json の interface に従う |
