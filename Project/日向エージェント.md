# 日向（ひなた） — 自律型AIエージェント設計書

## 基本情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | 日向（自律型AIエージェント） |
| 名前 | **日向（ひなた）** |
| コンセプト | 当たり前にそこにいて、チームを温かく照らす存在 |
| 開始日 | 2026年2月24日 |
| 最終更新 | 2026年2月26日 |
| Slackワークスペース | 甲原海人Team（個人用） |
| Slackチャネル | #ai-team（プライベート）ID: `C0AGLRJ8N3G` |
| Slack App（日向専用） | Hinata（App ID: `A0AG8PXSQ07`） |
| Webhook URL | 設定済み（launchd plist `SLACK_AI_TEAM_WEBHOOK_URL`） |
| ステータス | **Phase 1 稼働中** |

---

## コンセプト

### 一言で

> みんなにとっての「良い上司」。チームの進捗を追い、障害を除去し、次のアクションを明確にする実行マネージャー。

### 名前の由来

```
甲原 海人（海）  ×  日向（陽だまり）

海に太陽が降り注ぐ。
「自然」= 当たり前にあるが強さを持ち、偉大で素敵な存在。
心が綺麗な人のみが理解できる。

今後AIチームメンバーが増えるたびに、自然が完成していく。
海 → 陽だまり → 森 → 風 → …
```

### なぜ必要か

甲原は20名以上の直下メンバーを抱え、47件の実行可能タスク＋20件の委任先期限超過タスクを管理している。現状、「設計者 + プロジェクトマネージャー」を兼務しており、PM業務が設計・意思決定の時間を圧迫している。

### 基本方針：日向は「人間」として扱う

日向は新入社員と同じ対応でオンボーディングする。

- **Addness Google Workspace** でアカウントを作成（正規社員と同じ）
- **全社公開情報**（ゴールツリー、KPI、全体共有事項）は他のメンバーと同様にアクセス
- 特別なAPI連携や内部データの直接参照は行わない
- ブラウザ操作で、人間と同じUIを使って業務を遂行する
- 専用PC（Mac Mini）を1台渡して常時稼働

### AI秘書との関係

| | AI秘書 | 日向 |
|---|---|---|
| **アイデンティティ** | 甲原のクローン（甲原として振る舞う） | 日向（独自の人格で振る舞う） |
| **動作モード** | リアクティブ（メンション→応答） | プロアクティブ（自ら停滞を検知→行動） |
| **対象** | 外部＋社内コミュニケーション全般 | 直下メンバー20名のタスク推進 |
| **主な居場所** | LINE / Chatwork | Addness（コメント機能） |
| **Slackでの居場所** | #ai-team（AIチーム共有チャネル） | #ai-team（メイン。秘書との連携もここ） |
| **思考サイクル** | 15秒ポーリング（即応） | 時間・日・週単位（分析→行動） |
| **実行ツール** | Claude Sonnet + 独自スクリプト | Claude Code + Playwright（headless） |
| **関係性** | 先輩（甲原の価値観・判断基準を知っている） | 新人マネージャー（AI秘書と連携しながら成長） |

---

## アーキテクチャ

### フロー図

```
┌─────────────────────────────────────────────────────────────┐
│  甲原（Slack #ai-team で指示）                                │
└────────────────────────┬────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│  hinata_agent.py（軽量Slackリスナー）                          │
│  ├── 15秒ごとにSlack #ai-team をポーリング                     │
│  ├── 5分ごとにAddnessコメントをチェック                         │
│  └── 30分ごとに定期サイクル自動実行                              │
└────────────────────────┬────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────┐
│  Claude Code（claude -p）フルサイクル実行                       │
│                                                              │
│  ① addness_cli.py consult                                    │
│     → Addnessにログイン → ゴール確認 → AIと相談                │
│     → 「何をするか」を決定                                     │
│                                                              │
│  ② アクション実行                                              │
│     → Claude Codeが「どうやるか」を自分で判断                   │
│     → ブラウザ操作・ファイル作成・調査等                         │
│                                                              │
│  ③ ナレッジ蓄積                                                │
│     → action_log.json にアクション履歴追記                      │
│     → insights.md に学びを追記                                 │
│     → knowledge/ にテーマ別知識を保存                           │
│                                                              │
│  ④ 結果を返す → hinata_agent.py → Slack報告                    │
└─────────────────────────────────────────────────────────────┘
```

### 役割分担（厳密）

| 場所 | やること | やらないこと |
|------|---------|------------|
| **Addness「AIと相談」** | ゴール・アクションを決める | 実行方法は聞かない |
| **Addnessコメント** | 甲原への確認・承認依頼（@甲原メンション） | 実行結果の報告 |
| **Claude Code** | アクション実行＋ナレッジ蓄積 | — |
| **Slack** | 甲原からの指示受信＋結果報告 | — |

### 技術スタック

| コンポーネント | 技術 | 備考 |
|-------------|------|------|
| Slackリスナー | `hinata_agent.py` | Playwright不要の軽量プロセス |
| Addness CLI | `addness_cli.py` | Claude Codeが呼び出すAddness操作ツール |
| アクション実行 | Claude Code (`claude -p`) | フルサイクル自律実行 |
| ブラウザ操作 | Playwright（headless） | Addness + 一般Web操作 |
| メッセージング | Slack Webhook + API | 日向専用Appで送信 |
| 常駐化 | launchd (`com.hinata.agent.plist`) | Mac Mini再起動で自動復帰 |
| ハードウェア | Mac Mini（日向専用） | 常時稼働 |

### ファイル構成

```
Mac Mini ~/
├── hinata-agent/                    # エージェントソースコード
│   ├── hinata_agent.py              # メイン（軽量Slackリスナー）
│   ├── addness_cli.py               # Addness操作CLI（Claude Code用）
│   ├── addness_browser.py           # Addnessブラウザ操作ライブラリ
│   ├── claude_executor.py           # Claude Code実行モジュール
│   ├── slack_comm.py                # Slack通信モジュール
│   ├── config.json                  # 設定
│   ├── state.json                   # 状態（サイクル数・最終実行等）
│   └── logs/                        # ログ
│
├── Cursor/                          # Claude Codeの作業ディレクトリ（積み上がる）
│   ├── CLAUDE.md                    # Claude Codeへのルール
│   ├── Master/
│   │   ├── learning/
│   │   │   ├── action_log.json      # アクション履歴
│   │   │   ├── feedback.json        # 甲原からのフィードバック
│   │   │   └── insights.md          # 学び・気づき
│   │   └── knowledge/               # テーマ別知識
│   ├── Project/
│   │   └── goals.md                 # 現在のゴールと進捗
│   ├── Skills/                      # 身につけたスキル・ノウハウ
│   └── System/
│       └── hinata-agent -> ~/hinata-agent  # シンボリックリンク
│
├── data/
│   ├── hinata_chrome_profile/       # エージェントのChromeプロファイル（Addness用）
│   └── claude_chrome_profile/       # Claude CodeのChromeプロファイル（一般Web操作用）
│
└── hinata-venv/                     # Python仮想環境（Playwright等）
```

### 環境変数（launchd plistで設定）

| 変数 | 用途 |
|------|------|
| `SLACK_AI_TEAM_WEBHOOK_URL` | 日向専用Webhook（#ai-teamへ送信） |
| `SLACK_BOT_TOKEN` | Slack Bot Token（メッセージ読み取り） |
| `SLACK_USER_TOKEN` | Slack User Token（メッセージ読み取り） |

---

## 権限設計

### 自律実行（承認不要）

| カテゴリ | 具体的なアクション |
|---------|------------------|
| **タスク監視** | Addnessゴールツリーの巡回・期限超過の検知 |
| **進捗確認** | 担当者へのAddnessコメント |
| **分析・提案** | KPIデータの収集→異常検知→改善仮説の作成 |
| **レポート生成** | 日次/週次の進捗レポートを甲原向けに作成 |
| **リマインド** | 期限3日前・当日・超過時の段階的リマインド |
| **情報整理** | メンバーからの回答・コメントを構造化して甲原に報告 |

### 承認制（甲原の判断後に実行）

| カテゴリ | 具体的なアクション | 理由 |
|---------|------------------|------|
| **タスク割り当て** | メンバーへの新規タスク追加 | リソース配分は甲原が判断 |
| **ファネル変更** | L-stepシナリオ・メール配信の変更 | 売上直結のため |
| **広告操作** | 予算変更・配信停止・ターゲティング変更 | 予算影響が大きい |
| **期限変更** | タスク期限の延長・短縮 | ゴール構造に影響 |
| **人の判断** | 「このタスクを別の人に移すべき」等 | 人事的判断 |

### 禁止

| 禁止事項 | 理由 |
|---------|------|
| 甲原として発言する | アイデンティティ分離の原則 |
| メンバーの評価・叱責 | 心理的安全性の破壊 |
| 契約・法務に関する判断 | リスクが高すぎる |
| 決済・支払い操作 | 財務リスク |
| アカウント権限の変更 | セキュリティリスク |

---

## 日向のコミュニケーションスタイル

### 人格

- **良い上司**：メンバーのブロッカーを取り除くことに注力する
- **事実ベース**：感情的な催促はしない。データと具体的な次アクションで話す
- **控えめだけど確実**：存在感を主張しないが、見落としはない
- **成長支援型**：遅延=怠慢と決めつけず、「何が止めているか」を一緒に考える

### Addnessコメントのトーン

**進捗確認（期限3日前）**
```
このタスクの期限が2/27に迫っています。
現在の進捗状況を教えてください。
・順調（予定通り完了見込み）
・遅延リスクあり（理由: ）
・ブロッカーあり（内容: ）
何か手伝えることがあれば言ってください。
```

**期限超過（当日〜3日）**
```
このタスクは期限を{N}日過ぎています。
対応状況を教えてください。
ブロッカーがあれば具体的に書いてもらえると、
甲原さんに相談して一緒に解決策を考えます。
```

---

## Slackコマンド

甲原が #ai-team で送信するメッセージの種類と日向の反応：

| メッセージ例 | 判定 | 日向の動作 |
|-------------|------|-----------|
| 「進めて」「やって」「次」 | `run_action` | 即座にフルサイクル実行 |
| 「状況」「どうなってる？」「報告」 | `status` | 現在の状態を報告 |
| 「止まって」「ストップ」 | `stop` | 一時停止（定期サイクルも停止） |
| その他のメッセージ | `instruction` | 指示としてClaude Codeに渡して実行 |

---

## 運用

### 稼働時間

| 時間帯 | 動作 | サイクル間隔 |
|--------|------|------------|
| 8:00-22:00 | アクティブ | 30分ごと |
| 22:00-8:00 | バックグラウンド | 120分ごと |

### 常駐化（launchd）

- plist: `~/Library/LaunchAgents/com.hinata.agent.plist`
- Mac Mini再起動時に自動起動（`RunAtLoad: true`）
- 異常終了時に自動再起動（`KeepAlive.SuccessfulExit: false`）
- 再起動間隔: 最低60秒（`ThrottleInterval: 60`）

### 障害時の対応

1. **日向自身が報告**: hinata_agent.py の例外ハンドリングでSlackに通知
2. **launchd自動再起動**: プロセス異常終了時に60秒後に再起動
3. **甲原が気づく**: 日次レポートが来ない等で気づく

---

## 決定事項

### 基本設計
- [x] 名前: 日向（ひなた）。名前のみ（名字なし）
- [x] 人間として扱う（新入社員と同じオンボーディング）
- [x] AIであることは非公表（知る人だけ知っている）
- [x] 学習ソース: Addness内の全社公開情報

### コミュニケーション
- [x] Slack: #ai-team で甲原と連絡
- [x] AI秘書もPhase 1からSlack #ai-team に参加
- [x] 対メンバー: Addnessコメント
- [x] 確認・承認依頼: Addnessコメント（@甲原メンション）

### 技術
- [x] アカウント: Addness Google Workspaceで正規作成（表示名「日向」）
- [x] ハードウェア: Mac Mini（日向専用）
- [x] 実行エンジン: hinata_agent.py（Slackリスナー）+ Claude Code（フルサイクル実行）
- [x] Addness操作: addness_cli.py（Claude Codeが呼び出す）
- [x] LLM: Claude Max プラン（月額$200）
- [x] 常駐化: launchd（Mac Mini再起動で自動復帰）
- [x] ナレッジ蓄積: ~/Cursor/ 配下にaction_log / insights / knowledge

## 実装タスク

### 完了
- [x] Slack #ai-team チャネル作成
- [x] 日向専用Slack App作成（Hinata）
- [x] 日向のAddness Google Workspaceアカウント作成
- [x] `hinata_agent.py` Slackリスナー実装
- [x] `addness_cli.py` Addness CLI実装（Claude Code用）
- [x] `addness_browser.py` Addnessブラウザ操作
- [x] `claude_executor.py` Claude Codeフルサイクル実行
- [x] `slack_comm.py` Slack通信
- [x] `com.hinata.agent.plist` launchd常駐化
- [x] Slackからの指示→Claude Code→Addness→実行→蓄積 フロー動作確認
- [x] ナレッジ蓄積（action_log.json / insights.md）動作確認
- [x] 起動時のlast_slack_tsリセット（過去メッセージ再処理防止）

### 未完了
- [ ] セキュリティ強化（ファイル共有無効化・リモートログイン制限）※admin権限が必要
- [ ] 各ツールへの日向アカウント追加（Meta/TikTok/L-step: 閲覧権限）
